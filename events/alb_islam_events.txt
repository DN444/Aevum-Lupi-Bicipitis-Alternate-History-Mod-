namespace = alb_islam_events

#Jafar ibn rashid
country_event = {
	id = alb_islam_events.1
	title = alb_islam_events.1.test
	desc = alb_islam_events.1.desc
	picture = muslimgfx_REFORM_eventPicture
	
	trigger = {
		is_year = 1520
		REB = {
			NOT = {
				check_variable = {
					which = caliph_authority_var
					value = 50
				}
			}
		}
		any_owned_province = {
			region = arabia_region
			culture_group = turko_semitic
			religion = islam
		}
	}
	mean_time_to_happen = {
		months = 12
		modifier = {
			factor = 0.2
			tag = event_target:islam_caliph_target
		}
	}
	fire_only_once = yes
	option = {
		name = alb_islam_events.1a
		random_owned_province = {
			limit = {
				region = arabia_region
				culture_group = turko_semitic
				religion = islam
			}
			add_permanent_province_modifier = {
				name = jafar_al_rashidi_activity
				duration = -1
			}
		}
		set_global_flag = jafar_al_rashid_preaching
	}
	option = {
		name = alb_islam_events.1b
		trigger = {
			NOT = {
				tag = event_target:islam_caliph_target
			}
		}
		random_owned_province = {
			limit = {
				region = arabia_region
				culture_group = turko_semitic
				religion = islam
			}
			add_permanent_province_modifier = {
				name = jafar_al_rashidi_activity
				duration = -1
			}
		}
		add_country_modifier = {
			name = accepting_to_rashidis_modifier
			duration = -1
		}
		set_global_flag = jafar_al_rashid_preaching
	}
}

#Rashidi community established itself
country_event = {
	id = alb_islam_events.2
	title = alb_islam_events.2.test
	desc = alb_islam_events.2.desc
	picture = muslimgfx_REFORM_eventPicture
	
	trigger = {
		has_global_flag = jafar_al_rashid_preaching
		any_owned_province = {
			NOT = {
				has_province_modifier = rashidi_community_in_province
			}
			region = arabia_region
			culture_group = turko_semitic
			religion = islam
		}
		NOT = {
			calc_true_if = {
				amount = 31
				all_province = {
					has_province_modifier = rashidi_community_in_province
				}
			}
		}
	}
	mean_time_to_happen = {
		months = 100
		modifier = {
			factor = 0.9
			has_country_modifier = accepting_to_rashidis_modifier
		}
		modifier = {
			factor = 0.75
			any_neighbor_province = {
				
					has_province_modifier = rashidi_community_in_province
					
				
			}
		}
		modifier = {
			factor = 0.75
			any_neighbor_province = {
				has_province_modifier = jafar_al_rashidi_activity
			}
		}
		
		modifier = {
			factor = 2
			has_country_modifier = rashidi_expel_10_year_cooldown
		}
	}
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					NOT = {
						has_province_modifier = rashidi_community_in_province
					}
					religion = islam
				}
				save_event_target_as = rashidi_community_province
			}
		}
	}
	option = {
		name = alb_islam_events.2a
		event_target:rashidi_community_province = {
			add_permanent_province_modifier = {
				name = rashidi_community_in_province
				duration = -1
			}
		}
	}
	option = {
		name = alb_islam_events.2b
		event_target:rashidi_community_province = {
			add_permanent_province_modifier = {
				name = rashidi_community_in_province
				duration = -1
			}
		}
		add_country_modifier = {
			name = accepting_to_rashidis_modifier
			duration = -1
		}
	}
}

#Rashid flees the nation
country_event = {
	id = alb_islam_events.3
	title = alb_islam_events.3.test
	desc = alb_islam_events.3.desc
	picture = muslimgfx_REFORM_eventPicture
	
	is_triggered_only = yes
	option = {
		name = alb_islam_events.3a
		random_owned_province = {
			limit = {
				religion = islam
			}
			add_permanent_province_modifier = {
				name = jafar_al_rashidi_activity
				duration = -1
			}
		}
	}
	option = {
		name = alb_islam_events.3b
		random_owned_province = {
			limit = {
				religion = islam
			}
			add_permanent_province_modifier = {
				name = jafar_al_rashidi_activity
				duration = -1
			}
		}
		add_country_modifier = {
			name = accepting_to_rashidis_modifier
			duration = -1
		}
	}
}

#The Rashidi Caliphate
country_event = {
	id = alb_islam_events.4
	title = alb_islam_events.4.test
	desc = alb_islam_events.4.desc
	picture = muslimgfx_REFORM_eventPicture
	
	trigger = {
		REB = {
			NOT = {
				check_variable = {
					which = caliph_authority_var
					value = 0.001
				}
			}
		}
		any_province = {
			OR = {
				has_province_modifier = rashidi_community_in_province
				has_province_modifier = jafar_al_rashidi_activity
			}
		}
		has_global_flag = jafar_al_rashid_preaching
	}
	mean_time_to_happen = {
		months = 6
	}

	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						has_province_modifier = rashidi_community_in_province
						has_province_modifier = jafar_al_rashidi_activity
					}
				}
				cede_province = RS0
				add_core = RS0
				remove_province_modifier = rashidi_community_in_province
				remove_province_modifier = jafar_al_rashidi_activity
				random_list = {
					50 = {
						change_religion = rashidi
					}
					50 = {
						
					}
				}
			}
			RS0 = {
				if = {
					limit = {
						is_year = 1565
					}
					define_ruler = {
						name = "Muhammad al-Jeddahi"
						dynasty = "Usfurid"
						claim = 95
						adm = 5
						dip = 3
						mil = 3
						age = 44
					}
				}
				add_manpower = 30
				add_treasury = 500
				save_global_event_target_as = alb_rashidi_caliphate_target
			}
			RS0 = {
				capital_scope = {
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					infantry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					cavalry = RS0
					artillery = RS0
					artillery = RS0
					artillery = RS0
					artillery = RS0
					artillery = RS0
					artillery = RS0
				}
				add_country_modifier = {
					name = alb_rise_of_rashidi_caliphate
					duration = 9125
				}
			}
			every_country = {
				limit = {
					any_owned_province = {
						OR = {
							has_province_modifier = rashidi_community_in_province
							has_province_modifier = jafar_al_rashidi_activity
						}
					}
				}
				country_event = {
					id = alb_islam_events.5
				}
			}
		}
	}
	option = {
		name = alb_islam_events.4a
		declare_war_with_cb = {
			casus_belli = cb_annex
			who = RS0
		}
		
	}
	option = {
		name = alb_islam_events.4b
		declare_war_with_cb = {
			casus_belli = cb_annex
			who = RS0
		}
		change_tag = RS0

	}
}

#The Rashidi Caliphate for other countries
country_event = {
	id = alb_islam_events.5
	title = alb_islam_events.5.test
	desc = alb_islam_events.5.desc
	picture = muslimgfx_REFORM_eventPicture
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						has_province_modifier = rashidi_community_in_province
						has_province_modifier = jafar_al_rashidi_activity
					}
				}
				cede_province = RS0
				add_core = RS0
				random_list = {
					50 = {
						change_religion = rashidi
					}
					50 = {
						
					}
				}
			}
		}
	}
	option = {
		name = alb_islam_events.5a
		declare_war_with_cb = {
			casus_belli = cb_annex
			who = RS0
		}
	}
	option = {
		name = alb_islam_events.5b
		declare_war_with_cb = {
			casus_belli = cb_annex
			who = RS0
		}
		change_tag = RS0
	}
}